import{y as T,x as $,K,m as P}from"./Scrollbar.ec68d90a.js";import{d as q,r as g,o as H,w as M,b,h as y,F as z,z as V}from"./runtime-core.esm-bundler.caa95594.js";function j(e=8){return Math.random().toString(16).slice(2,2+e)}function x(e){return typeof e=="string"?document.querySelector(e):e()}function N(e){return e instanceof HTMLElement}function D(e){for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes[t];if(N(i)&&(X(i)||D(i)))return!0}return!1}function O(e){for(let t=e.childNodes.length-1;t>=0;t--){const i=e.childNodes[t];if(N(i)&&(X(i)||O(i)))return!0}return!1}function X(e){if(!G(e))return!1;try{e.focus({preventScroll:!0})}catch{}return document.activeElement===e}function G(e){if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.getAttribute("disabled"))return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return e.type!=="hidden"&&e.type!=="file";case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}}let f=[];const Z=q({name:"FocusTrap",props:{disabled:Boolean,active:Boolean,autoFocus:{type:Boolean,default:!0},onEsc:Function,initialFocusTo:String,finalFocusTo:String,returnFocusOnDeactivated:{type:Boolean,default:!0}},setup(e){const t=j(),i=g(null),l=g(null);let u=!1,r=!1;const s=typeof document>"u"?null:document.activeElement;function v(){return f[f.length-1]===t}function E(n){var o;n.code==="Escape"&&v()&&((o=e.onEsc)===null||o===void 0||o.call(e,n))}H(()=>{M(()=>e.active,n=>{n?(Y(),$("keydown",document,E)):(T("keydown",document,E),u&&p())},{immediate:!0})}),b(()=>{T("keydown",document,E),u&&p()});function S(n){if(!r&&v()){const o=w();if(o===null||o.contains(K(n)))return;a("first")}}function w(){const n=i.value;if(n===null)return null;let o=n;for(;o=o.nextSibling,!(o===null||o instanceof Element&&o.tagName==="DIV"););return o}function Y(){var n;if(!e.disabled){if(f.push(t),e.autoFocus){const{initialFocusTo:o}=e;o===void 0?a("first"):(n=x(o))===null||n===void 0||n.focus({preventScroll:!0})}u=!0,document.addEventListener("focus",S,!0)}}function p(){var n;if(e.disabled||(document.removeEventListener("focus",S,!0),f=f.filter(m=>m!==t),v()))return;const{finalFocusTo:o}=e;o!==void 0?(n=x(o))===null||n===void 0||n.focus({preventScroll:!0}):e.returnFocusOnDeactivated&&s instanceof HTMLElement&&(r=!0,s.focus({preventScroll:!0}),r=!1)}function a(n){if(v()&&e.active){const o=i.value,m=l.value;if(o!==null&&m!==null){const h=w();if(h==null||h===m){r=!0,o.focus({preventScroll:!0}),r=!1;return}r=!0;const _=n==="first"?D(h):O(h);r=!1,_||(r=!0,o.focus({preventScroll:!0}),r=!1)}}}function U(n){if(r)return;const o=w();o!==null&&(n.relatedTarget!==null&&o.contains(n.relatedTarget)?a("last"):a("first"))}function W(n){r||(n.relatedTarget!==null&&n.relatedTarget===i.value?a("last"):a("first"))}return{focusableStartRef:i,focusableEndRef:l,focusableStyle:"position: absolute; height: 0; width: 0;",handleStartFocus:U,handleEndFocus:W}},render(){const{default:e}=this.$slots;if(e===void 0)return null;if(this.disabled)return e();const{active:t,focusableStyle:i}=this;return y(z,null,[y("div",{"aria-hidden":"true",tabindex:t?"0":"-1",ref:"focusableStartRef",style:i,onFocus:this.handleStartFocus}),e(),y("div",{"aria-hidden":"true",style:i,ref:"focusableEndRef",tabindex:t?"0":"-1",onFocus:this.handleEndFocus})])}});let c=0,L="",R="",k="",I="";const C=g("0px");function ee(e){if(typeof document>"u")return;const t=document.documentElement;let i,l=!1;const u=()=>{t.style.marginRight=L,t.style.overflow=R,t.style.overflowX=k,t.style.overflowY=I,C.value="0px"};H(()=>{i=M(e,r=>{if(r){if(!c){const s=window.innerWidth-t.offsetWidth;s>0&&(L=t.style.marginRight,t.style.marginRight=`${s}px`,C.value=`${s}px`),R=t.style.overflow,k=t.style.overflowX,I=t.style.overflowY,t.style.overflow="hidden",t.style.overflowX="hidden",t.style.overflowY="hidden"}l=!0,c++}else c--,c||u(),l=!1},{immediate:!0})}),b(()=>{i?.(),l&&(c--,c||u(),l=!1)})}const F=g(!1),A=()=>{F.value=!0},B=()=>{F.value=!1};let d=0;const te=()=>(P&&(V(()=>{d||(window.addEventListener("compositionstart",A),window.addEventListener("compositionend",B)),d++}),b(()=>{d<=1?(window.removeEventListener("compositionstart",A),window.removeEventListener("compositionend",B),d=0):d--})),F);export{Z as F,te as a,ee as u};
